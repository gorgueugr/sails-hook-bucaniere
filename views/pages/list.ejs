<h1><%= model %></h1>
<p>Total records: <%= total %></p>

<div class="table-container">
  <table class="table is-hoverable is-fullwidth is-narrow">
    <thead>
      <tr>
        <% for (let prop in all[0]) { %>
        <th><%= prop %></th>
        <% } %>
        <th colspan="2"><%# Action buttons %></th>
      </tr>
    </thead>

    <tbody>
      <% all.forEach((item, index) => { %>
      <tr>
        <% for (let prop in item) { %>
        <td><%= item[prop] %></td>
        <% } %>

        <td><button class="button is-small" onclick="openEditModal(<%= index %>)">Edit</button></td>
        <td><button class="button is-small is-danger">Delete</button></td>
      </tr>
      <% }) %>
    </tbody>
  </table>
</div>

<div id="modal-edit" class="modal">
  <div class="modal-background" onclick="closeEditModal()"></div>
  <div class="modal-card">
    <header class="modal-card-head">
      <p class="modal-card-title">Edit Item</p>
      <button class="delete" aria-label="close" onclick="closeEditModal()"></button>
    </header>

    <section class="modal-card-body">
      <% for (let name in attributes) {
        const attribute = attributes[name]
        const type = (attribute.model || attribute.type === 'number') ? 'number' : 'text'
        const disabled = attribute.autoUpdatedAt || attribute.autoCreatedAt %>
      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label"><%= name %></label>
        </div>
        <div class="field-body">
          <div id="attribute-<%= name %>" class="field">
            <div class="control">
              <input class="input" type="<%= type %>" <%= disabled ? 'disabled' : '' %>>
            </div>
            <p class="help"><%= attribute.required ? 'Required' : '' %></p>
          </div>
        </div>
      </div>
      <% } %>
    </section>

    <footer class="modal-card-foot">
      <button class="button is-success">Save changes</button>
      <button class="button" onclick="closeEditModal()">Cancel</button>
    </footer>
  </div>
</div>

<script>
const editModal = document.querySelector('#modal-edit')

function openEditModal (itemIndex) {
  editModal.classList.add('is-active')

  const item = SAILS_LOCALS.all[itemIndex]
  for (let attribute in item) {
    document.querySelector(`#attribute-${attribute} input`).value = item[attribute]
  }
}

function closeEditModal () {
  editModal.classList.remove('is-active')
}
</script>

<%- exposeLocalsToBrowser() %>